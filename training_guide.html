

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Training Guide &mdash; CryoPARES 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration Guide" href="configuration_guide.html" />
    <link rel="prev" title="CryoPARES Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CryoPARES
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Training Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training-parameters">Training Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#essential-parameters">Essential Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-configuration-parameters">Data Configuration Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimizer-configuration">Optimizer Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-architecture-parameters">Model Architecture Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-augmentation-parameters">Data Augmentation Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#monitoring-training-with-tensorboard">Monitoring Training with TensorBoard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#launching-tensorboard">Launching TensorBoard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-metrics-to-monitor">Key Metrics to Monitor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#training-loss-loss">1. Training Loss (<code class="docutils literal notranslate"><span class="pre">loss</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validation-loss-val-loss">2. Validation Loss (<code class="docutils literal notranslate"><span class="pre">val_loss</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#angular-error-geo-degs-val-geo-degs">3. Angular Error (<code class="docutils literal notranslate"><span class="pre">geo_degs</span></code>, <code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#median-angular-error-val-median-geo-degs">4. Median Angular Error (<code class="docutils literal notranslate"><span class="pre">val_median_geo_degs</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#learning-rate-lr">5. Learning Rate (<code class="docutils literal notranslate"><span class="pre">lr</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualization-rotation-matrices">6. Visualization: Rotation Matrices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-tensorboard-monitoring-session">Example TensorBoard Monitoring Session</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#overfitting-and-underfitting">Overfitting and Underfitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-overfitting">What is Overfitting?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-underfitting">What is Underfitting?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-sweet-spot">The Sweet Spot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-preprocessing">Data Preprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#image-size-and-sampling-rate">Image Size and Sampling Rate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#masking">Masking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ctf-correction">CTF Correction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-training-options">Advanced Training Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#continue-training">Continue Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fine-tuning">Fine-tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#half-set-training">Half-Set Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulated-pre-training">Simulated Pre-training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-compilation">Model Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-overfitting-on-small-batches">Debugging: Overfitting on Small Batches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-training-issues">Troubleshooting Training Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#training-is-very-slow">Training is very slow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#out-of-memory-errors">Out of memory errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#too-many-open-files-error">“Too many open files” error</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loss-is-nan">Loss is NaN</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-not-improving">Model not improving</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation-loss-jumps-around">Validation loss jumps around</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration_guide.html">Configuration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#configuration-system-overview">Configuration System Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#configuration-sources-in-order-of-precedence">Configuration Sources (in order of precedence)</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#using-config-overrides">Using Config Overrides</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#using-yaml-config-files">Using YAML Config Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#viewing-available-options">Viewing Available Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#configuration-hierarchy">Configuration Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#reading-configuration-files">Reading Configuration Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#configuration-file-locations">Configuration File Locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#how-to-read-configuration-files">How to Read Configuration Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#example-finding-training-parameters">Example: Finding Training Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#example-finding-nested-parameters">Example: Finding Nested Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#quick-parameter-reference">Quick Parameter Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#saving-and-loading-configurations">Saving and Loading Configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#exporting-current-configuration">Exporting Current Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#reusing-a-configuration">Reusing a Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_guide.html#overriding-loaded-config">Overriding Loaded Config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration_guide.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cli.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#cryopares-train"><code class="docutils literal notranslate"><span class="pre">cryopares_train</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#parameters">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#configuration-overrides">Configuration Overrides</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#view-all-config-options">View All Config Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#important-notes">Important Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#cryopares-infer"><code class="docutils literal notranslate"><span class="pre">cryopares_infer</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id1">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id2">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id3">Configuration Overrides</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id4">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#output-files">Output Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id5">See Also</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#cryopares-projmatching"><code class="docutils literal notranslate"><span class="pre">cryopares_projmatching</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id6">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id7">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#cryopares-reconstruct"><code class="docutils literal notranslate"><span class="pre">cryopares_reconstruct</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id8">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id9">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id10">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#compactify-checkpoint"><code class="docutils literal notranslate"><span class="pre">compactify_checkpoint</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id11">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#required-arguments">Required Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#optional-arguments">Optional Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#id12">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#what-s-included">What’s Included</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#size-reduction">Size Reduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#using-compactified-checkpoints">Using Compactified Checkpoints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#utility-scripts">Utility Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli.html#gmm-histogram-analysis">GMM Histogram Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#fsc-computation">FSC Computation</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#pose-comparison">Pose Comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#learning-curve-visualization">Learning Curve Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html#star-file-histograms">STAR File Histograms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#id13">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#installation-issues">Installation Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#pip-install-fails-with-dependency-conflicts">pip install fails with dependency conflicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#importerror-no-module-named-cryopares">ImportError: No module named ‘cryoPARES’</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#cuda-version-mismatch">CUDA version mismatch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#configuration-issues">Configuration Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#type-mismatch-errors-when-using-config">Type mismatch errors when using –config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#file-system-issues">File System Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#too-many-open-files-error">“Too many open files” error</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#permission-denied-when-writing-outputs">Permission denied when writing outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#particle-files-not-found">Particle files not found</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#memory-issues">Memory Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#out-of-memory-oom-during-training">Out of memory (OOM) during training</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#out-of-memory-during-inference">Out of memory during inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#ram-exhausted-when-loading-data">RAM exhausted when loading data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#training-issues">Training Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#loss-becomes-nan">Loss becomes NaN</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#training-doesn-t-improve">Training doesn’t improve</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#validation-loss-higher-than-training-loss">Validation loss higher than training loss</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#training-crashes-with-killed">Training crashes with “Killed”</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#checkpoints-not-saving">Checkpoints not saving</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#inference-issues">Inference Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#predicted-poses-are-random">Predicted poses are random</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#reconstruction-is-blurry">Reconstruction is blurry</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#no-particles-passed-confidence-threshold">“No particles passed confidence threshold”</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#inference-slower-than-expected">Inference slower than expected</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#data-issues">Data Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#ctf-parameters-missing">CTF parameters missing</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#orientation-columns-missing">Orientation columns missing</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#particles-are-poorly-centered">Particles are poorly centered</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#different-sampling-rate-in-data-vs-reference">Different sampling rate in data vs. reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#performance-issues">Performance Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#training-is-very-slow">Training is very slow</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#inference-is-very-slow">Inference is very slow</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#data-loading-is-bottleneck">Data loading is bottleneck</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#cuda-gpu-issues">CUDA/GPU Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#cuda-out-of-memory-but-gpu-seems-empty">“CUDA out of memory” but GPU seems empty</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#multiple-gpus-not-being-used">Multiple GPUs not being used</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#gpu-slower-than-expected">GPU slower than expected</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#output-quality-issues">Output Quality Issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#reconstruction-has-artifacts">Reconstruction has artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#fsc-is-lower-than-expected">FSC is lower than expected</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#reconstructed-map-has-wrong-hand">Reconstructed map has wrong hand</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#getting-more-help">Getting More Help</a><ul>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#enable-debug-mode">Enable Debug Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#check-logs">Check Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html#report-issues">Report Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#core-modules">Core Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/training.html">Training API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/training.html#module-cryoPARES.train.train">Main Training Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/training.html#module-cryoPARES.train.runTrainOnePartition">Training Execution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/inference.html">Inference API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#module-cryoPARES.inference.inferencer">Single Inferencer</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#module-cryoPARES.inference.infer">Distributed Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/inference.html#daemon-mode">Daemon Mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/projection_matching.html">Projection Matching API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/projection_matching.html#module-cryoPARES.projmatching.projMatcher">Projection Matcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/projection_matching.html#module-cryoPARES.projmatching.projmatching">Command-Line Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/reconstruction.html">Reconstruction API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/reconstruction.html#module-cryoPARES.reconstruction.reconstructor">Reconstructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/reconstruction.html#module-cryoPARES.reconstruction.reconstruct">Command-Line Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/data_management.html">Data Management API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/data_management.html#module-cryoPARES.datamanager.datamanager">Data Manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/data_management.html#module-cryoPARES.datamanager.particlesDataset">Particles Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/data_management.html#module-cryoPARES.datamanager.augmentations">Augmentations</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/data_management.html#module-cryoPARES.datamanager.ctf.rfft_ctf">CTF Correction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/models.html">Models API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/models.html#module-cryoPARES.models.model">PyTorch Lightning Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/models.html#module-cryoPARES.models.image2sphere.image2sphere">Image2Sphere Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/models.html#image-encoders">Image Encoders</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/models.html#module-cryoPARES.models.directionalNormalizer.directionalNormalizer">Directional Normalizer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/utils.html">Utilities API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="api/utils.html#checkpoint-management">Checkpoint Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/utils.html#module-cryoPARES.utils.paths">Path Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/utils.html#module-cryoPARES.utils.torchUtils">PyTorch Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/utils.html#module-cryoPARES.utils.reconstructionUtils">Reconstruction Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/utils.html#geometry-utilities">Geometry Utilities</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/rsanchezgarc/cryoPARES">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.biorxiv.org/content/10.1101/2025.03.04.641536v2">Paper</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CryoPARES</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Training Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/training_guide.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="training-guide">
<h1>Training Guide<a class="headerlink" href="#training-guide" title="Link to this heading"></a></h1>
<p>This guide provides detailed instructions for training CryoPARES models, including best practices for avoiding overfitting/underfitting and monitoring training progress.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Training in CryoPARES takes a set of pre-aligned particles (from RELION, cryoSPARC, or other alignment tools) and
learns a deep learning model that can predict particle orientations.
The training process produces a checkpoint directory (named <code class="docutils literal notranslate"><span class="pre">version_0</span></code>, <code class="docutils literal notranslate"><span class="pre">version_1</span></code>, etc.)
containing the trained model weights.
<strong>Training an accurate model is essential for obtaining good results during inference</strong> - the quality of your
trained model directly determines the accuracy of pose predictions on new data.</p>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#quick-start"><span class="xref myst">Quick Start</span></a></p></li>
<li><p><a class="reference internal" href="#training-parameters"><span class="xref myst">Training Parameters</span></a></p></li>
<li><p><a class="reference internal" href="#monitoring-training-with-tensorboard"><span class="xref myst">Monitoring Training with TensorBoard</span></a></p></li>
<li><p><a class="reference internal" href="#overfitting-and-underfitting"><span class="xref myst">Overfitting and Underfitting</span></a></p></li>
<li><p><a class="reference internal" href="#data-preprocessing"><span class="xref myst">Data Preprocessing</span></a></p></li>
<li><p><a class="reference internal" href="#advanced-training-options"><span class="xref myst">Advanced Training Options</span></a></p></li>
<li><p><a class="reference internal" href="#troubleshooting-training-issues"><span class="xref myst">Troubleshooting Training Issues</span></a></p></li>
</ul>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading"></a></h2>
<p>Basic training command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--symmetry<span class="w"> </span>C1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--particles_star_fname<span class="w"> </span>/path/to/aligned_particles.star<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--particles_dir<span class="w"> </span>/path/to/particles<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--train_save_dir<span class="w"> </span>/path/to/output<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n_epochs<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--batch_size<span class="w"> </span><span class="m">32</span>
</pre></div>
</div>
<p><strong>Important:</strong> Before training, increase the file descriptor limit:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">ulimit</span><span class="w"> </span>-n<span class="w"> </span><span class="m">65536</span>
</pre></div>
</div>
<p>If you cannot increase it, make sure that you group all your images into a small number of stack files (.mrcs).</p>
</section>
<section id="training-parameters">
<h2>Training Parameters<a class="headerlink" href="#training-parameters" title="Link to this heading"></a></h2>
<section id="essential-parameters">
<h3>Essential Parameters<a class="headerlink" href="#essential-parameters" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--symmetry</span></code></p></td>
<td><p>str</p></td>
<td><p>Required</p></td>
<td><p>Point group symmetry (C1, D7, T, O, I, etc.)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--particles_star_fname</span></code></p></td>
<td><p>str</p></td>
<td><p>Required</p></td>
<td><p>Path to pre-aligned RELION .star file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--train_save_dir</span></code></p></td>
<td><p>str</p></td>
<td><p>Required</p></td>
<td><p>Output directory for checkpoints and logs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--n_epochs</span></code></p></td>
<td><p>int</p></td>
<td><p>100</p></td>
<td><p>Number of training epochs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--batch_size</span></code></p></td>
<td><p>int</p></td>
<td><p>32</p></td>
<td><p>Number of particles per batch</p></td>
</tr>
</tbody>
</table>
</section>
<section id="data-configuration-parameters">
<h3>Data Configuration Parameters<a class="headerlink" href="#data-configuration-parameters" title="Link to this heading"></a></h3>
<p>Override via <code class="docutils literal notranslate"><span class="pre">--config</span></code> flag with dot notation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>datamanager.particlesDataset.sampling_rate_angs_for_nnet<span class="o">=</span><span class="m">2</span>.0<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>datamanager.particlesDataset.image_size_px_for_nnet<span class="o">=</span><span class="m">128</span>
</pre></div>
</div>
<p><strong>Key data parameters:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.particlesDataset.sampling_rate_angs_for_nnet</span></code></strong> (float)</p>
<ul>
<li><p>Target sampling rate in Ångströms/pixel</p></li>
<li><p>Images are rescaled to this value before training</p></li>
<li><p>Lower values = higher resolution but more memory/compute</p></li>
<li><p>Downsampling helps to reduce noise</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.particlesDataset.image_size_px_for_nnet</span></code></strong> (int)</p>
<ul>
<li><p>Final image size in pixels after rescaling</p></li>
<li><p>Images are cropped/padded to this size</p></li>
<li><p>Must be large enough to contain the particle after rescaling</p>
<ul>
<li><p>But we recommend using tight boxes</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.particlesDataset.mask_radius_angs</span></code></strong> (float, optional)</p>
<ul>
<li><p>Radius of circular mask in Ångströms</p></li>
<li><p>If not set, uses half the box size</p></li>
<li><p>Helps the network focus on the particle</p></li>
<li><p>Notice that image_size_px_for_nnet is not the same as mask_radius_angs, but that they should be closely related.</p></li>
</ul>
</li>
</ul>
</section>
<section id="optimizer-configuration">
<h3>Optimizer Configuration<a class="headerlink" href="#optimizer-configuration" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>train.learning_rate<span class="o">=</span>1e-3<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>train.weight_decay<span class="o">=</span>1e-5<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>train.accumulate_grad_batches<span class="o">=</span><span class="m">16</span>
</pre></div>
</div>
<p><strong>Key optimizer parameters:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">train.learning_rate</span></code></strong> (float, default: 1e-3)</p>
<ul>
<li><p>Controls how much to update model weights during each training step</p></li>
<li><p>The learning rate determines the size of the steps taken during gradient descent optimization</p></li>
<li><p>Higher learning rate = faster training but risk of overshooting optimal weights</p></li>
<li><p>Lower learning rate = more stable training but slower convergence</p></li>
<li><p><strong>Good values:</strong> 1e-4 to 1e-3 depending on your data and model complexity</p></li>
<li><p>Start with default (1e-3) and adjust based on training behavior</p></li>
<li><p>Automatically reduced by 0.5 when validation loss plateaus (see <code class="docutils literal notranslate"><span class="pre">patient_reduce_lr_plateau_n_epochs</span></code> below)</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">train.weight_decay</span></code></strong> (float)</p>
<ul>
<li><p>L2 regularization coefficient</p></li>
<li><p>Incrase it to reduce overfitting</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">train.accumulate_grad_batches</span></code></strong> (int)</p>
<ul>
<li><p>Number of batches to accumulate gradients over</p></li>
<li><p>Simulates larger batch sizes: effective_batch_size = batch_size × accumulate_grad_batches</p></li>
<li><p>Useful when GPU memory is limited</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">train.patient_reduce_lr_plateau_n_epochs</span></code></strong> (int, default: 3)</p>
<ul>
<li><p>Patience for ReduceLROnPlateau scheduler</p></li>
<li><p>LR reduced by 0.5 if val_loss doesn’t improve for this many epochs</p></li>
</ul>
</li>
</ul>
</section>
<section id="model-architecture-parameters">
<h3>Model Architecture Parameters<a class="headerlink" href="#model-architecture-parameters" title="Link to this heading"></a></h3>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>models.image2sphere.lmax<span class="o">=</span><span class="m">8</span><span class="w"> </span>models.image2sphere.so3components.i2sprojector.sphere_fdim<span class="o">=</span><span class="m">128</span><span class="w"> </span>
</pre></div>
</div>
<p><strong>Key architecture parameters:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.lmax</span></code></strong> (int, default: 12)</p>
<ul>
<li><p>Maximum spherical harmonic degree for SO(3) representation</p></li>
<li><p>Higher values = more expressive model but slower training and more memory usage</p></li>
<li><p>Typical values: 8, 10, 12</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.label_smoothing</span></code></strong> (float, default: 0.05)</p>
<ul>
<li><p>Label smoothing factor for loss function to prevent overconfidence</p></li>
<li><p>Range: 0.0 (no smoothing) to 0.2 (strong smoothing)</p></li>
<li><p>Helps with generalization</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.so3components.i2sprojector.sphere_fdim</span></code></strong> (int, default: 512)</p>
<ul>
<li><p>Feature dimension for spherical representation in the image-to-sphere projector</p></li>
<li><p>Higher values = more capacity but slower training</p></li>
<li><p>Typical values: 256, 512, 1024</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.so3components.i2sprojector.rand_fraction_points_to_project</span></code></strong> (float, default: 0.5)</p>
<ul>
<li><p>Fraction of points to randomly sample for projection (reduces computation)</p></li>
<li><p>Acts like a form of dropout</p></li>
<li><p>Range: 0.1 to 1.0 (1.0 = use all points)</p></li>
<li><p>Lower values = faster, potentially less accurate while more robust to overfitting</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.so3components.s2conv.f_out</span></code></strong> (int, default: 64)</p>
<ul>
<li><p>Number of output features from S2 (sphere) convolution</p></li>
<li><p>Higher values = more capacity but slower training and potentially more overfitting</p></li>
<li><p>Typical values: 32, 64, 128</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.so3components.i2sprojector.hp_order</span></code></strong> (int, default: 3)</p>
<ul>
<li><p>HEALPix order for image-to-sphere projector grid resolution</p></li>
<li><p>Higher values = finer resolution but more computation and potentially more overfitting</p></li>
<li><p>Each increment roughly doubles resolution. Going beyond 4 is not advisable</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.so3components.s2conv.hp_order</span></code></strong> (int, default: 4)</p>
<ul>
<li><p>HEALPix order for S2 convolution grid resolution</p></li>
<li><p>Controls the resolution of spherical convolution</p></li>
<li><p>Higher values = finer resolution but more computation and potentially more overfitting</p></li>
<li><p>Each increment roughly doubles resolution. Going beyond 4 is not advisable</p></li>
<li></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">models.image2sphere.so3components.so3outputgrid.hp_order</span></code></strong> (int, default: 4)</p>
<ul>
<li><p>HEALPix order for SO(3) output grid resolution</p></li>
<li><p>Affects the final orientation prediction granularity</p></li>
<li><p>Higher values = finer resolution but more computation and potentially more overfitting</p></li>
<li><p>Each increment roughly doubles resolution. Going beyond 4 is not advisable</p></li>
</ul>
</li>
</ul>
</section>
<section id="data-augmentation-parameters">
<h3>Data Augmentation Parameters<a class="headerlink" href="#data-augmentation-parameters" title="Link to this heading"></a></h3>
<p>Data augmentation is <strong>enabled by default</strong> and helps the model generalize by creating variations of training images.
CryoPARES applies multiple augmentation operations randomly to each particle image. By default, each image gets
augmented several times in the same batch.</p>
<p><strong>View current augmentation settings:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cryopares_train<span class="w"> </span>--show-config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="s2">&quot;augmenter:&quot;</span>
</pre></div>
</div>
<p><strong>Key augmentation parameters:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.augment_train</span></code></strong> (bool, default: True)</p>
<ul>
<li><p>Enable/disable data augmentation for training</p></li>
<li><p>Keep enabled for better generalization</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.num_augmented_copies_per_batch</span></code></strong> (int, default: 4)</p>
<ul>
<li><p>Number of augmented copies per particle in each batch</p></li>
<li><p>Each copy undergoes different random augmentations</p></li>
<li><p>Batch size must be divisible by this value</p></li>
<li><p>Higher values improve robustness but increase computation</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.augmenter.prob_augment_each_image</span></code></strong> (float, default: 0.95)</p>
<ul>
<li><p>Probability of applying augmentation to each image</p></li>
<li><p>Range: 0.0 (no augmentation) to 1.0 (always augment)</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.augmenter.min_n_augm_per_img</span></code></strong> (int, default: 1)</p>
<ul>
<li><p>Minimum number of augmentation operations to apply per image</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datamanager.augmenter.max_n_augm_per_img</span></code></strong> (int, default: 8)</p>
<ul>
<li><p>Maximum number of augmentation operations to apply per image</p></li>
</ul>
</li>
</ul>
<p><strong>Available augmentation operations (with default probabilities):</strong></p>
<ul class="simple">
<li><p><strong>Gaussian noise</strong> (<code class="docutils literal notranslate"><span class="pre">operations.randomGaussNoise.p=0.1</span></code>)</p>
<ul>
<li><p>Adds random Gaussian noise to simulate imaging variations</p></li>
</ul>
</li>
<li><p><strong>Uniform noise</strong> (<code class="docutils literal notranslate"><span class="pre">operations.randomUnifNoise.p=0.2</span></code>)</p>
<ul>
<li><p>Adds uniform random noise</p></li>
</ul>
</li>
<li><p><strong>Gaussian blur</strong> (<code class="docutils literal notranslate"><span class="pre">operations.gaussianBlur.p=0.2</span></code>)</p>
<ul>
<li><p>Blurs the image to simulate defocus variations</p></li>
</ul>
</li>
<li><p><strong>Size perturbation</strong> (<code class="docutils literal notranslate"><span class="pre">operations.sizePerturbation.p=0.2</span></code>)</p>
<ul>
<li><p>Slightly scales the particle (simulates magnification errors)</p></li>
</ul>
</li>
<li><p><strong>Random erasing</strong> (<code class="docutils literal notranslate"><span class="pre">operations.erasing.p=0.1</span></code>)</p>
<ul>
<li><p>Randomly erases rectangular regions (simulates occlusions)</p></li>
</ul>
</li>
<li><p><strong>Elastic deformation</strong> (<code class="docutils literal notranslate"><span class="pre">operations.randomElastic.p=0.1</span></code>)</p>
<ul>
<li><p>Applies elastic distortions to the image</p></li>
</ul>
</li>
<li><p><strong>In-plane rotations (90°)</strong> (<code class="docutils literal notranslate"><span class="pre">operations.inPlaneRotations90.p=1.0</span></code>)</p>
<ul>
<li><p>Rotates by 90°, 180°, or 270° (always applied for SO(3) symmetry)</p></li>
</ul>
</li>
<li><p><strong>In-plane rotations (small)</strong> (<code class="docutils literal notranslate"><span class="pre">operations.inPlaneRotations.p=0.5</span></code>)</p>
<ul>
<li><p>Random rotations up to ±20° (simulates alignment errors)</p></li>
</ul>
</li>
<li><p><strong>In-plane shifts</strong> (<code class="docutils literal notranslate"><span class="pre">operations.inPlaneShifts.p=0.5</span></code>)</p>
<ul>
<li><p>Random shifts up to 5% of image size (simulates centering errors)</p></li>
</ul>
</li>
</ul>
<p><strong>Example: Adjusting augmentation strength</strong></p>
<p>To reduce augmentation (if underfitting is an issue):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>datamanager.augmenter.prob_augment_each_image<span class="o">=</span><span class="m">0</span>.5<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>datamanager.augmenter.max_n_augm_per_img<span class="o">=</span><span class="m">4</span>
</pre></div>
</div>
<p>To increase augmentation (to combat overfitting):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>datamanager.num_augmented_copies_per_batch<span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>datamanager.augmenter.prob_augment_each_image<span class="o">=</span><span class="m">0</span>.98<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>datamanager.augmenter.operations.gaussianBlur.p<span class="o">=</span><span class="m">0</span>.3
</pre></div>
</div>
<p>To disable specific augmentations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>datamanager.augmenter.operations.randomElastic.p<span class="o">=</span><span class="m">0</span>.0<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>datamanager.augmenter.operations.erasing.p<span class="o">=</span><span class="m">0</span>.0
</pre></div>
</div>
</section>
</section>
<section id="monitoring-training-with-tensorboard">
<h2>Monitoring Training with TensorBoard<a class="headerlink" href="#monitoring-training-with-tensorboard" title="Link to this heading"></a></h2>
<p>CryoPARES uses PyTorch Lightning, which automatically logs metrics to TensorBoard.</p>
<section id="launching-tensorboard">
<h3>Launching TensorBoard<a class="headerlink" href="#launching-tensorboard" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tensorboard<span class="w"> </span>--logdir<span class="w"> </span>/path/to/train_save_dir/version_0
</pre></div>
</div>
<p>Then open your browser to <code class="docutils literal notranslate"><span class="pre">http://localhost:6006</span></code></p>
</section>
<section id="key-metrics-to-monitor">
<h3>Key Metrics to Monitor<a class="headerlink" href="#key-metrics-to-monitor" title="Link to this heading"></a></h3>
<section id="training-loss-loss">
<h4>1. Training Loss (<code class="docutils literal notranslate"><span class="pre">loss</span></code>)<a class="headerlink" href="#training-loss-loss" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Should decrease steadily during training</p></li>
<li><p>Measures how well the model predicts rotations on training data</p></li>
<li><p>If it plateaus early, try:</p>
<ul>
<li><p>Increasing learning rate</p></li>
<li><p>Checking if data augmentation is too aggressive</p></li>
<li><p>Reducing weight decay</p></li>
</ul>
</li>
</ul>
</section>
<section id="validation-loss-val-loss">
<h4>2. Validation Loss (<code class="docutils literal notranslate"><span class="pre">val_loss</span></code>)<a class="headerlink" href="#validation-loss-val-loss" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Most important metric for model quality</p></li>
<li><p>Should track training loss but slightly higher</p></li>
<li><p><strong>Warning signs:</strong></p>
<ul>
<li><p>Val loss much higher than train loss → overfitting</p></li>
<li><p>Val loss not decreasing → underfitting or learning rate too low</p></li>
</ul>
</li>
</ul>
</section>
<section id="angular-error-geo-degs-val-geo-degs">
<h4>3. Angular Error (<code class="docutils literal notranslate"><span class="pre">geo_degs</span></code>, <code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code>)<a class="headerlink" href="#angular-error-geo-degs-val-geo-degs" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Average angular error in degrees.</p></li>
<li><p><strong>Goal:</strong> As low as possible (typically &lt; 15° for good models, but depends on the quality of the training particles subest.
We have seen successful models with errors as high as 25°)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code> is the key metric for final model quality</p></li>
<li><p>It is easier to check for overfitting comparing <code class="docutils literal notranslate"><span class="pre">geo_degs</span></code> vs <code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code>. If <code class="docutils literal notranslate"><span class="pre">geo_degs</span></code> improves but <code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code>
does not, you are in the overfitting regime.</p></li>
</ul>
</section>
<section id="median-angular-error-val-median-geo-degs">
<h4>4. Median Angular Error (<code class="docutils literal notranslate"><span class="pre">val_median_geo_degs</span></code>)<a class="headerlink" href="#median-angular-error-val-median-geo-degs" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>More robust to outliers than the mean, this metric reports the largest angular error among the best-aligned 50% of particles.</p></li>
<li><p>Should also decrease during training</p></li>
<li><p><strong>Goal:</strong> As low as possible (typically &lt; 8° for good models)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code> and <code class="docutils literal notranslate"><span class="pre">val_median_geo_degs</span></code> represent the same property, but aggregated in a different manner.
They should follow the same trends.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code> value is much larger than <code class="docutils literal notranslate"><span class="pre">val_median_geo_degs</span></code>, it suggests a heavy tail of large errors—often due to
junk or misaligned particles. Consider improving the training set via:</p>
<ul>
<li><p>Consensus alignments (e.g., remove particles with conflicting orientations between cryoSPARC and RELION).</p></li>
<li><p>Particle pruning (drop obvious outliers or low-quality picks).</p></li>
<li><p>Additional filtering/classification steps as needed.</p></li>
</ul>
</li>
</ul>
</section>
<section id="learning-rate-lr">
<h4>5. Learning Rate (<code class="docutils literal notranslate"><span class="pre">lr</span></code>)<a class="headerlink" href="#learning-rate-lr" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Displayed in optimizer logs</p></li>
<li><p>Watch for automatic reductions via ReduceLROnPlateau</p></li>
<li><p>If LR drops too early, increase <code class="docutils literal notranslate"><span class="pre">train.patient_reduce_lr_plateau_n_epochs</span></code></p></li>
</ul>
</section>
<section id="visualization-rotation-matrices">
<h4>6. Visualization: Rotation Matrices<a class="headerlink" href="#visualization-rotation-matrices" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>TensorBoard shows predicted vs. ground truth rotation matrices</p></li>
<li><p>Available under “Images” tab</p></li>
<li><p>Visual confirmation that the model is learning meaningful rotations</p></li>
</ul>
</section>
</section>
<section id="example-tensorboard-monitoring-session">
<h3>Example TensorBoard Monitoring Session<a class="headerlink" href="#example-tensorboard-monitoring-session" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start training</span>
python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--symmetry<span class="w"> </span>C1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--particles_star_fname<span class="w"> </span>data/particles.star<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--train_save_dir<span class="w"> </span>experiments/run_001<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n_epochs<span class="w"> </span><span class="m">20</span>

<span class="c1"># In another terminal, launch TensorBoard</span>
tensorboard<span class="w"> </span>--logdir<span class="w"> </span>experiments/run_001/version_0

<span class="c1"># Monitor these curves:</span>
<span class="c1"># 1. loss (should decrease smoothly)</span>
<span class="c1"># 2. val_loss (should track loss)</span>
<span class="c1"># 3. val_geo_degs (target: &lt; 20 degrees) /val_median_geo_degs (target: &lt;8 degrees)</span>
<span class="c1"># 4. Learning rate (should stay constant, then drop on plateau)</span>
</pre></div>
</div>
</section>
</section>
<section id="overfitting-and-underfitting">
<h2>Overfitting and Underfitting<a class="headerlink" href="#overfitting-and-underfitting" title="Link to this heading"></a></h2>
<section id="what-is-overfitting">
<h3>What is Overfitting?<a class="headerlink" href="#what-is-overfitting" title="Link to this heading"></a></h3>
<p>Overfitting occurs when the model learns to memorize training data instead of generalizing to new data.</p>
<p><strong>Symptoms:</strong></p>
<ul class="simple">
<li><p>Training loss continues to decrease while validation loss increases or plateaus</p></li>
<li><p>Large gap between <code class="docutils literal notranslate"><span class="pre">loss</span></code> and <code class="docutils literal notranslate"><span class="pre">val_loss</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code> stops improving or gets worse</p></li>
</ul>
<p><strong>Solutions:</strong></p>
<ol class="arabic">
<li><p><strong>Increase regularization:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>train.weight_decay<span class="o">=</span>1e-4<span class="w">  </span>models.image2sphere.label_smoothing<span class="o">=</span><span class="m">0</span>.1<span class="w"> </span><span class="c1"># Increase from default 1e-5, and 0.05 respectively</span>
</pre></div>
</div>
</li>
<li><p><strong>Reduce model complexity:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>models.image2sphere.lmax<span class="o">=</span><span class="m">10</span><span class="w"> </span><span class="c1"># Decrease from default 12 models.image2sphere.lmax=10</span>
</pre></div>
</div>
</li>
<li><p><strong>Add more training data:</strong></p>
<ul class="simple">
<li><p>Use more particles in your training .star file</p></li>
</ul>
</li>
<li><p><strong>Increase data augmentation:</strong>
Data augmentation is enabled by default. Check current settings:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span>--show-config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>augmentation
</pre></div>
</div>
</li>
</ol>
</section>
<section id="what-is-underfitting">
<h3>What is Underfitting?<a class="headerlink" href="#what-is-underfitting" title="Link to this heading"></a></h3>
<p>Underfitting occurs when the model is too simple to capture patterns in the data.</p>
<p><strong>Symptoms:</strong></p>
<ul class="simple">
<li><p>Both training and validation loss remain high</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code> &gt; 10 degrees even after many epochs</p></li>
<li><p>Loss curves plateau early</p></li>
</ul>
<p><strong>Solutions:</strong></p>
<ol class="arabic">
<li><p><strong>Increase model complexity:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>models.image2sphere.lmax<span class="o">=</span><span class="m">14</span><span class="w"> </span>models.image2sphere.so3components.i2sprojector.sphere_fdim<span class="o">=</span><span class="m">756</span><span class="w"> </span><span class="c1"># Increase from default 12</span>
</pre></div>
</div>
</li>
<li><p><strong>Reduce regularization:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>train.weight_decay<span class="o">=</span>1e-6<span class="w">  </span><span class="c1"># Decrease from default 1e-5</span>
</pre></div>
</div>
</li>
<li><p><strong>Check data preprocessing:</strong></p>
<ul class="simple">
<li><p>Ensure <code class="docutils literal notranslate"><span class="pre">sampling_rate_angs_for_nnet</span></code> matches your data resolution</p></li>
<li><p>Verify particle images are properly centered and normalized</p></li>
</ul>
</li>
</ol>
</section>
<section id="the-sweet-spot">
<h3>The Sweet Spot<a class="headerlink" href="#the-sweet-spot" title="Link to this heading"></a></h3>
<p><strong>Ideal training behavior:</strong></p>
<ul class="simple">
<li><p>Both <code class="docutils literal notranslate"><span class="pre">loss</span></code> and <code class="docutils literal notranslate"><span class="pre">val_loss</span></code> decrease together</p></li>
<li><p>Small gap between train and validation metrics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_geo_degs</span></code> reaches &lt; 15 degrees</p></li>
<li><p>Validation metrics improve for at least 50 epochs</p></li>
</ul>
<p><strong>Example of good training:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span><span class="p">:</span> <span class="n">Copy</span> <span class="n">here</span> <span class="kn">from</span><span class="w"> </span><span class="nn">bgal</span>
</pre></div>
</div>
</section>
</section>
<section id="data-preprocessing">
<h2>Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading"></a></h2>
<section id="image-size-and-sampling-rate">
<h3>Image Size and Sampling Rate<a class="headerlink" href="#image-size-and-sampling-rate" title="Link to this heading"></a></h3>
<p>The neural network operates on rescaled particle images. Understanding this is crucial:</p>
<ol class="arabic simple">
<li><p><strong>Original images:</strong> Read from <code class="docutils literal notranslate"><span class="pre">.star</span></code> file with original pixel size and sampling rate</p></li>
<li><p><strong>Rescaling:</strong> Images are rescaled to <code class="docutils literal notranslate"><span class="pre">sampling_rate_angs_for_nnet</span></code></p></li>
<li><p><strong>Crop/Pad:</strong> Images are cropped or padded to <code class="docutils literal notranslate"><span class="pre">image_size_px_for_nnet</span></code></p></li>
</ol>
<p><strong>Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Original: 256×256 px at 1.0 Å/px (256 Å box)
Target: 128×128 px at 2.0 Å/px (256 Å box)

Result: Image is downsampled by 2×, then center-cropped to 128×128
</pre></div>
</div>
<p><strong>Guidelines:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sampling_rate_angs_for_nnet</span></code>: 1.5-3.0 Å/px works well for most proteins</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image_size_px_for_nnet</span></code>: Should contain entire particle after rescaling, but we prefer tight boxes.</p></li>
<li><p>Rule of thumb: <code class="docutils literal notranslate"><span class="pre">image_size_px_for_nnet</span> <span class="pre">×</span> <span class="pre">sampling_rate_angs_for_nnet</span> <span class="pre">≥</span> <span class="pre">particle_diameter</span> <span class="pre">+</span> <span class="pre">padding</span></code></p></li>
</ul>
</section>
<section id="masking">
<h3>Masking<a class="headerlink" href="#masking" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>datamanager.particlesDataset.mask_radius_angs<span class="o">=</span><span class="m">100</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Applies a soft circular mask to focus on the particle</p></li>
<li><p>Set to slightly larger than particle radius</p></li>
<li><p>Too small → cuts off particle features</p></li>
<li><p>Too large → includes too much noise</p></li>
</ul>
</section>
<section id="ctf-correction">
<h3>CTF Correction<a class="headerlink" href="#ctf-correction" title="Link to this heading"></a></h3>
<p>CTF correction is applied automatically during training:</p>
<ul class="simple">
<li><p>Phase flip by default</p></li>
<li><p>Ensures the model sees properly corrected images</p></li>
</ul>
</section>
</section>
<section id="advanced-training-options">
<h2>Advanced Training Options<a class="headerlink" href="#advanced-training-options" title="Link to this heading"></a></h2>
<section id="continue-training">
<h3>Continue Training<a class="headerlink" href="#continue-training" title="Link to this heading"></a></h3>
<p>Resume from a previous checkpoint:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--continue_checkpoint_dir<span class="w"> </span>/path/to/train_save_dir/version_0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n_epochs<span class="w"> </span><span class="m">30</span><span class="w">  </span><span class="c1"># Train for 30 total epochs</span>
</pre></div>
</div>
</section>
<section id="fine-tuning">
<h3>Fine-tuning<a class="headerlink" href="#fine-tuning" title="Link to this heading"></a></h3>
<p>Start from a pre-trained model and adapt to new data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--symmetry<span class="w"> </span>C1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--particles_star_fname<span class="w"> </span>/path/to/new_particles.star<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--train_save_dir<span class="w"> </span>/path/to/finetuned_model<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--finetune_checkpoint_dir<span class="w"> </span>/path/to/pretrained_model/version_0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n_epochs<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>train.learning_rate<span class="o">=</span>1e-4<span class="w">  </span><span class="c1"># Lower LR for fine-tuning</span>
</pre></div>
</div>
</section>
<section id="half-set-training">
<h3>Half-Set Training<a class="headerlink" href="#half-set-training" title="Link to this heading"></a></h3>
<p>By default, CryoPARES trains two models (half1 and half2) for cross-validation:</p>
<p>This creates:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">version_0/half1/</span></code> - Model trained on particles with RandomSubset=1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version_0/half2/</span></code> - Model trained on particles with RandomSubset=2</p></li>
</ul>
<p><strong>Benefits:</strong></p>
<ul class="simple">
<li><p>Enables gold-standard FSC calculations</p></li>
<li><p>Recommended for production use</p></li>
</ul>
<p>To train on all data (single model):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--NOT_split_halves
</pre></div>
</div>
</section>
<section id="simulated-pre-training">
<h3>Simulated Pre-training<a class="headerlink" href="#simulated-pre-training" title="Link to this heading"></a></h3>
<p>Pre-train on simulated data before training on real particles:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--symmetry<span class="w"> </span>C1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--particles_star_fname<span class="w"> </span>/path/to/real_particles.star<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--train_save_dir<span class="w"> </span>/path/to/output<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--map_fname_for_simulated_pretraining<span class="w"> </span>/path/to/reference_map.mrc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n_epochs<span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>train.n_epochs_simulation<span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="c1">#We will train the model for 3 epochs using simulated data</span>
</pre></div>
</div>
<p>This first trains on simulated projections of the reference map, then fine-tunes on real data.</p>
</section>
<section id="model-compilation">
<h3>Model Compilation<a class="headerlink" href="#model-compilation" title="Link to this heading"></a></h3>
<p>Speed up training with PyTorch compilation (requires PyTorch 2.0+):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--compile_model
</pre></div>
</div>
<p><strong>Note:</strong> Compilation adds overhead at startup but can speed up training by 10-30%.</p>
</section>
<section id="debugging-overfitting-on-small-batches">
<h3>Debugging: Overfitting on Small Batches<a class="headerlink" href="#debugging-overfitting-on-small-batches" title="Link to this heading"></a></h3>
<p>Test your setup quickly by overfitting on a few batches:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>cryopares_train<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--symmetry<span class="w"> </span>C1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--particles_star_fname<span class="w"> </span>/path/to/particles.star<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--train_save_dir<span class="w"> </span>/tmp/overfit_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--n_epochs<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--overfit_batches<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting-training-issues">
<h2>Troubleshooting Training Issues<a class="headerlink" href="#troubleshooting-training-issues" title="Link to this heading"></a></h2>
<section id="training-is-very-slow">
<h3>Training is very slow<a class="headerlink" href="#training-is-very-slow" title="Link to this heading"></a></h3>
<p><strong>Solutions:</strong></p>
<ul class="simple">
<li><p>Enable model compilation: <code class="docutils literal notranslate"><span class="pre">--compile_model</span></code></p></li>
<li><p>Reduce image size: <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">datamanager.particlesDataset.image_size_px_for_nnet=96</span></code></p></li>
<li><p>Increase batch size: <code class="docutils literal notranslate"><span class="pre">--batch_size</span> <span class="pre">64</span></code></p></li>
<li><p>Use multiple GPUs (automatically detected)</p></li>
<li><p>Reduce model complexity, like <code class="docutils literal notranslate"><span class="pre">lmax</span></code>: <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">models.image2sphere.lmax=10</span></code>. Although it will have an impact on model performance (overfitting/underfitting)</p></li>
</ul>
</section>
<section id="out-of-memory-errors">
<h3>Out of memory errors<a class="headerlink" href="#out-of-memory-errors" title="Link to this heading"></a></h3>
<p><strong>Solutions:</strong></p>
<ul class="simple">
<li><p>Reduce batch size: <code class="docutils literal notranslate"><span class="pre">--batch_size</span> <span class="pre">16</span></code></p>
<ul>
<li><p>You can increase gradient accumulation to partially compensate for the reduction: <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">train.accumulate_grad_batches=32</span></code></p></li>
</ul>
</li>
<li><p>Reduce image size: <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">datamanager.particlesDataset.image_size_px_for_nnet=96</span></code></p></li>
</ul>
</section>
<section id="too-many-open-files-error">
<h3>“Too many open files” error<a class="headerlink" href="#too-many-open-files-error" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">ulimit</span><span class="w"> </span>-n<span class="w"> </span><span class="m">65536</span>
</pre></div>
</div>
<p>Run this before every training session, or add to <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ulimit -n 65536&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</section>
<section id="loss-is-nan">
<h3>Loss is NaN<a class="headerlink" href="#loss-is-nan" title="Link to this heading"></a></h3>
<p><strong>Causes:</strong></p>
<ul class="simple">
<li><p>Learning rate too high</p></li>
<li><p>Numerical instability</p></li>
</ul>
<p><strong>Solutions:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--config<span class="w"> </span>train.learning_rate<span class="o">=</span>1e-4<span class="w">  </span><span class="c1"># Reduce LR</span>
</pre></div>
</div>
</section>
<section id="model-not-improving">
<h3>Model not improving<a class="headerlink" href="#model-not-improving" title="Link to this heading"></a></h3>
<p><strong>Checklist:</strong></p>
<ol class="arabic simple">
<li><p>Verify data is properly aligned in the input .star file</p></li>
<li><p>Check that particles are centered</p></li>
<li><p>Ensure sufficient training data (&gt;100000 particles recommended)</p></li>
<li><p>Verify symmetry is correct</p></li>
<li><p>Try increasing learning rate: <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">train.learning_rate=5e-3</span></code></p></li>
<li><p>Increase model capacity: <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">models.image2sphere.lmax=12</span> <span class="pre">models.image2sphere.so3components.s2conv.f_out=128</span></code></p></li>
</ol>
</section>
<section id="validation-loss-jumps-around">
<h3>Validation loss jumps around<a class="headerlink" href="#validation-loss-jumps-around" title="Link to this heading"></a></h3>
<p><strong>Causes:</strong></p>
<ul class="simple">
<li><p>Validation set too small</p></li>
<li><p>Batch size too small</p></li>
</ul>
<p><strong>Solutions:</strong></p>
<ul class="simple">
<li><p>Ensure &gt;10000 particles in validation set</p></li>
<li><p>Increase batch size: <code class="docutils literal notranslate"><span class="pre">--batch_size</span> <span class="pre">64</span></code></p></li>
</ul>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="configuration_guide.html"><span class="std std-doc">Configuration Guide</span></a> - Detailed parameter reference</p></li>
<li><p><a class="reference external" href="https://rsanchezgarc.github.io/cryoPARES/api/">API Reference</a> - Type hints and function signatures</p></li>
<li><p><a class="reference internal" href="troubleshooting.html"><span class="std std-doc">Troubleshooting</span></a> - Common issues and solutions</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="CryoPARES Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configuration_guide.html" class="btn btn-neutral float-right" title="Configuration Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Ruben Sanchez-Garcia.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>